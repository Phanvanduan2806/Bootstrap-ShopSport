(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[551],{32951:function(e,t,n){"use strict";n.d(t,{HG:function(){return l},kI:function(){return s}});var i=n(85893);n(67294);var r=n(26042),o=n(69396),a=function(e){switch(e){case"sm":return 14;case"md":return 16;case"lg":return 18;case"xl":return 20;case"2xl":return 22;case"3xl":return 24;case"big":return 48;default:return"number"===typeof e?e:16}};var l=function(e){var t,n;return(0,i.jsx)("svg",(0,o.Z)((0,r.Z)({viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",width:e.width||(null===(t=e.style)||void 0===t?void 0:t.width)||a(e.size),height:e.height||(null===(n=e.style)||void 0===n?void 0:n.height)||a(e.size)},e),{children:(0,i.jsx)("g",{stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",children:(0,i.jsx)("path",{d:"M10 12v5M14 12v5M4 7h16M6 10v8a3 3 0 0 0 3 3h6a3 3 0 0 0 3-3v-8M9 5a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2H9V5Z"})})}))};var s=function(e){var t,n;return(0,i.jsxs)("svg",(0,o.Z)((0,r.Z)({viewBox:"0 0 64 64",xmlns:"http://www.w3.org/2000/svg",strokeWidth:5.2,stroke:"currentColor",fill:"none",width:e.width||(null===(t=e.style)||void 0===t?void 0:t.width)||a(e.size),height:e.height||(null===(n=e.style)||void 0===n?void 0:n.height)||a(e.size)},e),{children:[(0,i.jsx)("circle",{cx:29.22,cy:16.28,r:11.14}),(0,i.jsx)("path",{d:"M41.32 35.69c-2.69-1.95-8.34-3.25-12.1-3.25A22.55 22.55 0 0 0 6.67 55h29.9"}),(0,i.jsx)("circle",{cx:45.38,cy:46.92,r:11.94}),(0,i.jsx)("path",{d:"M38.98 46.8h14"})]}))}},33226:function(e,t,n){"use strict";n.d(t,{Z:function(){return it}});var i,r,o=n(47568),a=n(26042),l=n(69396),s=n(70655),c=n(85893),u=n(44104),d=n(53359),m=n(66489),v=n(96906),h=n(67294),f=n(44138),p=n(69728),x=n(23769),g=n(55856),b=n(1798),w=n.n(b),j=n(66314),y=n(10753),_=n(30642),N=n.n(_),C=n(32951),E=n(86010),S=function(e){var t=e.action,n=e.id,i=e.inChatBox,r=void 0!==i&&i;return(0,c.jsx)("li",(0,a.Z)({className:"chat-option hover:bg-blue-light text-ink-primary transition-all cursor-pointer px-2 py-1 rounded",onClick:function(){return function(e,t){r&&1==r?w().publish(u.qz.ACTION_MENU,{id:e,action:t}):w().publish(u.qz.ACTION_MENU_IN_SIDEBAR,{id:e,action:t})}(n,t)}},e))},A=function(e){var t=(0,a.Z)({},e),n=t.id,i=t.type,r=void 0===i?"private":i,o=t.isOwner,l=void 0!==o&&o,s=t.mute,d=void 0===s?"":s,m=t.isActive,v=void 0===m||m,f=t.inChatBox,p=void 0===f||f,x=(t.isLast,t.isRefreshItem),b=t.visible,_=void 0===b||b,A=(0,h.useState)(!1),I=A[0],M=A[1],T=(0,h.useState)(d),k=(T[0],T[1]);(0,h.useEffect)((function(){x&&M(!1);var e=w().subscribe(u.qz.IS_CLOSE_MENU,(function(e,t){var i=t.id;n==i&&M(!1)})),t=w().subscribe(u.hD.ROOM_MUTE_CONFIG_CHANGE,(function(e,t){var i=t.id,r=t.type;i&&i===n&&k(null!=r&&"null"!=r?"CHAT":"null")}));return function(){w().unsubscribe(e),w().unsubscribe(t)}}),[n,v,x,d]);var Z=(0,y.O)((function(){return M(!1)})),z=(0,j.$G)().t,R=function(){var e=(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(S,{inChatBox:p,id:n,action:u.kl.EDIT_ROOMNAME,children:z("Change group name")}),(0,c.jsx)(S,{inChatBox:p,id:n,caction:u.kl.SHOW_MEMBERS,children:z("List members")}),(0,c.jsx)(S,{inChatBox:p,id:n,action:u.kl.ADD_MEMBERS,children:z("Add member")}),(0,c.jsx)(S,{inChatBox:p,id:n,action:u.kl.REMOVE_MEMBER,children:z("Remove member")})]});return(0,c.jsx)(c.Fragment,{children:l?e:"contextgroup"!=r.toLocaleLowerCase()?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(S,{inChatBox:p,id:n,action:u.kl.EDIT_ROOMNAME,children:z("Change group name")}),(0,c.jsx)(S,{inChatBox:p,id:n,action:u.kl.SHOW_MEMBERS,children:z("List members")}),(0,c.jsx)(S,{inChatBox:p,id:n,action:u.kl.ADD_MEMBERS,children:z("Add member")})]}):(0,c.jsx)(S,{inChatBox:p,id:n,action:u.kl.SHOW_MEMBERS,children:z("List members")})})};return _?(0,c.jsxs)(c.Fragment,{children:[function(){if(v)return(0,c.jsx)("span",{className:(0,E.Z)("rounded-full hover:bg-blue-light transition-colors w-8 h-8 inline-flex cursor-pointer items-center justify-center",{"bg-gray-200":I}),onClick:function(){M(!I)},children:(0,c.jsx)(g.Z,{name:"dots-menu"})})}(),I&&(0,c.jsxs)("ul",{ref:Z,className:(0,E.Z)("list-chat-options absolute top-11 right-1 t-full rounded bg-white z-10 p-1 text-sm",N()["sub-menu"]),children:[p&&(0,c.jsx)(c.Fragment,{children:"private"!==r&&R()}),r&&"contextgroup"!=r.toLocaleLowerCase()&&"private"!=r.toLocaleLowerCase()&&(0,c.jsx)(S,{inChatBox:p,id:n,action:u.kl.LEAVE,children:z("Leave")}),(0,c.jsx)(S,{inChatBox:p,id:n,action:u.kl.CLEAR_CHAT,children:(0,c.jsxs)("div",{className:"flex items-center gap-3 font-bold p-1",children:[(0,c.jsx)(C.HG,{width:20,height:20}),z("Delete chat")]})})]})]}):(0,c.jsx)(c.Fragment,{})},I=n(77470),M=function(e){var t=e.onCloseChangeGroupName,n=e.roomId,i=e.onChangeGroupName,r=(0,j.$G)().t,o=(0,h.useState)(!1),a=o[0],l=o[1],s="";null!=document.querySelector("#group-chat-name-".concat(n))&&(s=document.querySelector("#group-chat-name-".concat(n)).textContent);var u=(0,h.useState)(s),d=u[0],m=u[1];return(0,c.jsx)("div",{className:"absolute w-full h-full bg-black z-10 shadow-lg p-2 px-3",children:(0,c.jsxs)("div",{className:"bg-white rounded-md p-4",children:[(0,c.jsx)("p",{className:"font-bold m-0 mb-4",children:r("Change group name")}),(0,c.jsxs)("div",{className:"flex items-center gap-2 justify-between",children:[(0,c.jsx)(I.o,{defaultValue:s+"",onChange:function(e){return t=e.currentTarget.value,m(t.trim()),void(0==t.trim().length?l(!0):l(!1));var t}}),(0,c.jsx)("span",{onClick:function(){return t()},className:"bg-gray-lighter flex items-center justify-center h-10 w-10 rounded-md cursor-pointer",children:(0,c.jsx)(g.Z,{size:18,name:"close"})}),(0,c.jsx)("span",{className:"h-10 w-10 ".concat(a?"cursor-not-allowed":""),children:(0,c.jsx)("span",{onClick:function(){return i(d)},className:"bg-blue-primary text-white flex items-center justify-center h-10 w-10 rounded-md cursor-pointer ".concat(a?"cursor-not-allowed opacity-40 pointer-events-none":""),children:(0,c.jsx)(g.Z,{size:18,name:"done"})})})]})]})})},T=n(30381),k=n.n(T),Z=n(84644),z=n(79290),R=function(e){var t=e.files;return(0,c.jsx)("div",{className:"flex flex-col gap-2",children:t&&t.length>0&&t.map((function(e){Z.D.isJsonString(e)&&(e=JSON.parse(e));var t=!!e.name&&null!=e.name.match(".pdf");return(0,c.jsxs)("div",{className:"message-file ".concat(e.type,"-attachment flex py-2"),"data-content":"'".concat(JSON.stringify(e),"'"),children:["image"==e.type?(0,c.jsx)("a",{className:"block max-w-[200px]",href:e.url,target:"_blank",rel:"noreferrer",children:(0,c.jsx)("img",{className:"max-h-[400px] max-w-[200px] overflow-hidden object-contain",src:e.url,alt:e.name})}):(0,c.jsx)(c.Fragment,{}),"video"==e.type?(0,c.jsx)("video",{className:"max-h-[400px] max-w-[200px] max-w-full overflow-hidden",controls:!0,children:(0,c.jsx)("source",{src:e.url,type:"video/mp4"})}):(0,c.jsx)(c.Fragment,{}),"file"==e.type?(0,c.jsxs)("a",{className:"flex gap-2 hover:text-blue-pressed text-inherit",href:e.url,target:t?"_blank":"_self",download:!0,rel:"noreferrer",children:[(0,c.jsx)("span",{className:"text-gray flex items-start",children:(0,c.jsx)(g.Z,{size:40,name:"description"})}),(0,c.jsx)("div",{style:{wordBreak:"break-word"},className:"text-inherit text-sm overflow-hidden text-left",children:e.name})]}):(0,c.jsx)(c.Fragment,{})]},e.url)}))})},D=n(48929),O=n(9473),L=function(e){var t=(0,j.$G)().t,n=e.data,i=e.allowEdit,r=e.roomId,a=e.isPrivate,l=e.handleEdit,u=(0,O.v9)(D.tM),d=function(){var e=(0,o.Z)((function(e,t){return(0,s.__generator)(this,(function(n){return(0,m.bG)(e,t),[2]}))}));return function(t,n){return e.apply(this,arguments)}}(),v=function(){var e=z.Z.MessageData(null===n||void 0===n?void 0:n.id,"DELETE_MESSAGE",null,null,null,a,null===u||void 0===u?void 0:u.id);d(r,e).then((function(){}))};return(0,c.jsxs)("div",{className:N()["submenu-wrap"],children:[(0,c.jsx)(g.Z,{name:"dots-menu"}),(0,c.jsxs)("div",{className:N()["submenu-content"],children:[i?(0,c.jsx)("div",{onClick:function(){return function(){l&&l();var e=document.getElementById("chat-upload-btn-".concat(r));null!=e&&e.classList.add("btn-disabled")}()},title:t("Edit"),children:t("Edit")}):(0,c.jsx)(c.Fragment,{}),(0,c.jsx)("div",{onClick:function(){(0,x.gH)({message:t("Are you sure delete this message"),onConfirm:function(){v()}})},title:t("Delete"),children:t("Delete")})]})]})},F=function(e){var t=(0,O.v9)(D.tM),n=(0,j.$G)().t,i=e.message,r=e.fileHtml,o=e.roomId,a=e.isPrivate,l=e.handleEdit;return(0,c.jsxs)("div",{className:"".concat(N()["message-item-menu"]," ").concat((null===i||void 0===i?void 0:i.senderId)==(null===t||void 0===t?void 0:t.id)?N()["current-user"]:""),children:[(0,c.jsx)("div",{onClick:function(){w().publish(u.qz.REPLY_ACTION,{data:i,roomId:o})},title:n("Reply"),children:(0,c.jsx)(g.Z,{name:"reply"})}),(null===i||void 0===i?void 0:i.senderId)==(null===t||void 0===t?void 0:t.id)?(0,c.jsx)(L,{handleEdit:l,isPrivate:a,roomId:o,data:i,allowEdit:r}):(0,c.jsx)(c.Fragment,{})]})},U=n(52615),P=n(67841),B=n(87536),H=n(67887),G=n.n(H),W=function(e){var t=e.content,n=e.className,i=void 0===n?"":n;return(0,c.jsx)("div",{className:"".concat(i," ").concat(G().raw_text," ").concat(G().quiz_text),dangerouslySetInnerHTML:{__html:t}})},q=function(e){var t=e.isActive,n=e.isCurrentUser,i=e.roomId,r=e.isPrivate,u=e.data,d=(0,O.v9)(D.tM),v=(0,h.useState)(!1),f=v[0],p=v[1],x=(0,h.useState)(!1),b=x[0],w=x[1],y=(0,j.$G)().t,_=(0,B.cI)({defaultValues:{content:""}}),C=_.register,E=_.handleSubmit,S=(_.control,_.setValue),A=(_.watch,_.reset,_.getValues,_.formState.errors,function(){var e=(0,o.Z)((function(e,t){return(0,s.__generator)(this,(function(n){return(0,m.bG)(e,t),[2]}))}));return function(t,n){return e.apply(this,arguments)}}()),I=function(e){var t;if((null===e||void 0===e||null===(t=e.content)||void 0===t?void 0:t.length)>0){var n=null===e||void 0===e?void 0:e.content,o=null,a=document.getElementById("message-content-reply-".concat(u.id));null==a||a.classList.contains("hidden")||(o=JSON.parse(a.getAttribute("data-reply-object")));var l=z.Z.MessageData(u.id,"EDIT_MESSAGE",n,"",o,r,null===d||void 0===d?void 0:d.id);A(i,l).then((function(){p(!1)}));var s=document.getElementById("chat-upload-btn-".concat(i));null!=s&&s.classList.contains("btn-disabled")&&s.classList.remove("btn-disabled")}},M=function(e){return(0,c.jsxs)("form",{noValidate:!0,onSubmit:E(I),className:"".concat(f?"isEditting-message-".concat(i):"hidden"," w-full p-2 bg-blue-light rounded-md"),children:[(0,c.jsx)(U.g,(0,l.Z)((0,a.Z)({},C("content")),{onChange:function(e){return function(e){var t;(null===(t=e.trim())||void 0===t?void 0:t.length)>0?w(!1):w(!0)}(e.currentTarget.value)},onKeyDown:function(t){return function(e,t){if(13==e.keyCode){if(e.shiftKey)return;var n=document.getElementById("button-reply-".concat(t));null!=n&&(n.focus(),n.click(),e.currentTarget.focus(),e.preventDefault())}}(t,e)},placeholder:y("Typing..."),classNames:{root:"flex-grow mb-2"},id:"txt-reply-".concat(e)})),(0,c.jsxs)("div",{className:"flex items-center justify-end",children:[(0,c.jsx)(P.z,{onClick:function(){return function(){p(!1);var e=document.getElementById("chat-upload-btn-".concat(i));null!=e&&e.classList.contains("btn-disabled")&&e.classList.remove("btn-disabled")}()},variant:"outline",size:"xs",className:"h-10",children:(0,c.jsx)(g.Z,{name:"close"})}),(0,c.jsx)(P.z,{id:"button-reply-".concat(e),disabled:b,type:"submit",size:"xs",className:"ml-2 h-10",children:(0,c.jsx)(g.Z,{name:"done"})})]})]})};return(0,c.jsx)(c.Fragment,{children:function(){var e,o,a,l=void 0!==u.data?null===u||void 0===u||null===(e=u.data)||void 0===e?void 0:e.text:"",s=void 0!==u.data?null===u||void 0===u||null===(o=u.data)||void 0===o?void 0:o.url:"",d=void 0!==u.data?null===u||void 0===u||null===(a=u.data)||void 0===a?void 0:a.replyObject:"",m="",v="message",h="";u.deleted?(l=y("This message is deleted."),v+=" message-removed",h+=" bg-gray-light text-sm italic"):"undefined"!=typeof s&&(null===s||void 0===s?void 0:s.length)>0&&(m=(0,c.jsx)(R,{files:s}));var x="";void 0===u.updatedTime||u.deleted||(v+=" message-edited",x=y("Edited"));var b="";if(d){var w={};(function(e){try{JSON.parse(e)}catch(t){return!1}return!0})(d)&&(w=JSON.parse(d));var j;j=(0,c.jsx)("h4",{title:w.userName,className:"".concat(N()["reply-author"]," m-0 fs-12 truncate"),children:w.userName});var _="",C=w.url,E=z.Z.decodeQuote(w.text);if((null===C||void 0===C?void 0:C.length)>0){var A=Z.D.isJsonString(C[0])?JSON.parse(C[0]):C[0],I="file"==A.type,T=!!A.name&&null!=A.name.match(".pdf");_=(0,c.jsx)("p",{className:"reply-file mg-b-3 font-italic text-blue",children:(0,c.jsxs)("a",{href:A.url,target:!I||T?"_blank":"",rel:"noreferrer",download:I,children:["image"==A.type?(0,c.jsxs)("span",{className:"flex items-center gap-1",children:[(0,c.jsx)(g.Z,{name:"image",size:16})," ",y("Image")]}):(0,c.jsx)(c.Fragment,{}),"video"==A.type?(0,c.jsxs)("span",{className:"flex items-center gap-1",children:[(0,c.jsx)(g.Z,{name:"play-video",size:16})," ",y("Video")]}):(0,c.jsx)(c.Fragment,{}),"file"==A.type?(0,c.jsxs)("span",{className:"flex items-center gap-1",children:[(0,c.jsx)(g.Z,{name:"attachment",size:16})," ",y("Attachment file")]}):(0,c.jsx)(c.Fragment,{})]})})}b=(0,c.jsxs)("div",{id:"message-content-reply-".concat(u.id),className:"".concat(N()["content-reply"]," fs-14 text-left"),"data-reply-for":w.id,"data-reply-object":"".concat(z.Z.encodeSingleQuote(JSON.stringify(d))),children:[j,(0,c.jsxs)("div",{className:"wrap-content-reply",children:[_,(0,c.jsx)("div",{title:Z.D.escapeForTitleAttribute(Z.D.htmlDecode(E)),className:"message-text",style:{whiteSpace:"break-spaces",wordBreak:"break-word"},children:(0,c.jsx)(W,{content:z.Z.Linkify(Z.D.htmlEncode(E))})})]})]})}return(0,c.jsxs)("div",{className:v+" max-w-full "+(n?"text-right":"text-left"),id:"message-".concat(u.id),"data-id":u.id,"data-time-stamp":u.timestamp,children:[b,M(u.id),(0,c.jsxs)("div",{className:"".concat(N()["wrap-detail-message"]," relative inline-block"),children:[(0,c.jsxs)("div",{className:"message-content rounded-2xl px-3 py-2 ".concat(n?"bg-[#E6F4FF]":"bg-gray-lighter"," ").concat(h," ").concat(f?"hidden":""),style:{backgroundColor:u.deleted?"#C9C9C9":""},children:[m,(0,c.jsx)("div",{className:"".concat(N()["message-text"]," text-left"),"data-after":x,"data-content":Z.D.escapeForTitleAttribute(Z.D.htmlDecode(l)),style:{whiteSpace:"break-spaces",wordBreak:"break-word"},children:(0,c.jsx)(W,{content:z.Z.Linkify(l)})})]}),!u.deleted&&t?(0,c.jsx)(F,{handleEdit:function(){return function(e){var t;p(!0),S("content",Z.D.htmlDecode(null===u||void 0===u||null===(t=u.data)||void 0===t?void 0:t.text)),setTimeout((function(){var t,n=document.getElementById("txt-reply-".concat(e));null!=n&&(n.value=Z.D.htmlDecode(null===u||void 0===u||null===(t=u.data)||void 0===t?void 0:t.text),n.focus())}),200)}(u.id)},isPrivate:r,roomId:i,message:u,fileHtml:""==m}):(0,c.jsx)(c.Fragment,{})]})]})}()})},V=function(e){var t=e.data,n=e.isActive,i=e.roomId,r=e.isPrivate,o=e.isGroupMessage,a=void 0===o||o,l=e.hasAvatar,s=void 0!==l&&l,u=e.showAvatarOnly,d=void 0!==u&&u,m=(0,j.$G)().t,v=(0,O.v9)(D.tM);return(0,c.jsx)(c.Fragment,{children:function(){if(t.id){var e="message-container mb-1 flex gap-1 inline-block message-of-"+(null===t||void 0===t?void 0:t.senderId),o=!1,l="",u="";try{var h;if((null===t||void 0===t?void 0:t.senderId)==(null===v||void 0===v?void 0:v.id))o=!0,e+=" current-user justify-end";else e+=" justify-start",u=function(e){var t="",n="";try{return e.id==(null===v||void 0===v?void 0:v.id)?(t=m("You"),n=m("You")):(t=e.fullName?e.fullName:e.username,n=e.username?e.username:t),{name:t,account:n}}catch(i){return{name:t,account:n}}}(null===t||void 0===t?void 0:t.sender),l=(0,c.jsx)("img",{width:40,height:40,src:null===t||void 0===t||null===(h=t.sender)||void 0===h?void 0:h.avatarUrl,className:"mes-user-avatar flex-none h-7 w-7 rounded-full overflow-hidden border border-solid border-gray object-cover",alt:Z.D.escapeForTitleAttribute(u.account)}),u=(0,c.jsx)("h4",{className:"mes-user-name text-xs font-bold m-0 mb-1",title:Z.D.escapeForTitleAttribute(u.account),"data-user-name":Z.D.escapeForTitleAttribute(u.name),"data-user-id":null===t||void 0===t?void 0:t.senderId,children:Z.D.htmlEncode(u.name)})}catch(f){l="",u=""}return(0,c.jsxs)("div",{className:e,"data-time-stamp":null===t||void 0===t?void 0:t.timestamp,style:{maxWidth:o?"calc(100% - 68px)":"calc(100% - 36px)"},children:[a||s||d?l:(0,c.jsx)(c.Fragment,{}),(0,c.jsxs)("div",{className:"wrap-main-message flex flex-col items-start",children:[a||s||d?u:(0,c.jsx)(c.Fragment,{}),(0,c.jsx)("div",{className:"wrap-content-message w-full flex flex-col items-start ".concat(a||s||d?"":"pl-8"),children:(0,c.jsx)(q,{isPrivate:r,roomId:i,isCurrentUser:o,data:t,isActive:n})})]})]})}return""}()})},Y=n(62097),$=n.n(Y),J=function(e,t){var n=(0,O.v9)(D.tM),i=(0,j.$G)().t,r=function(e){var t="",r="";try{return e.id==n.id?(t=i("You"),r=i("You")):(t=e.fullName?e.fullName:e.username,r=e.username?e.username:t),{name:t,account:r}}catch(o){return{name:t,account:r}}},o="message-container message-notice",a=r(e.sender),l=a.name?a.name:a.account,s=(0,c.jsx)("span",{className:"".concat($()["mes-user-name"]," font-bold"),title:"".concat(a.name," (").concat(a.account,")"),children:l}),u=void 0===e.data?"DELETE":e.data.type,d=void 0===e.data?null:e.data.message,m=e.timestamp;switch(u){case"USERS_ADDED":if(o+=" user-added",d.members.length>1)t=(0,c.jsxs)(c.Fragment,{children:[i("added")," ",(0,c.jsxs)("span",{className:"".concat($()["mes-user-name"]," font-bold"),title:d.members.length+" "+i("members"),children:[" ",d.members.length," ",i("members")," "]})," ",i("to group")]});else{var v=d.members[0];v=r(v),t=(0,c.jsxs)(c.Fragment,{children:[i("added")," ",(0,c.jsxs)("span",{className:"".concat($()["mes-user-name"]," font-bold"),title:"".concat(v.name," (").concat(v.account,")"),children:[" ",v.name," "]})," ",i("to group")]})}break;case"USERS_REMOVED":if(o+=" user-removed",d.members.length>1)t=(0,c.jsxs)(c.Fragment,{children:[i("removed")," ",(0,c.jsxs)("span",{className:"".concat($()["mes-user-name"]," font-bold"),children:[" ",d.members.length," ",i("members")," "]})," ",i("from the group")]});else{var h=d.members[0];h=r(h),t=(0,c.jsxs)(c.Fragment,{children:[i("removed")," ",(0,c.jsxs)("span",{className:"".concat($()["mes-user-name"]," font-bold"),title:"".concat(h.name," (").concat(h.account,")"),children:[" ",h.name," "]})," ",i("from the group")]})}break;case"USERS_LEFT_ROOM":if(o+=" user-left-room",t=i("left the group"),null!=d&&null!=d.newOwner){var f=r(d.newOwner),p=d.newOwner.id==n.id?i("ARE_NEW_OWNER"):i("IS_NEW_OWNER"),x=d.newOwner.id==n.id?f.name:f.name+" ("+f.account+")";t=(0,c.jsxs)(c.Fragment,{children:[i("left the group"),"."," ",(0,c.jsx)("span",{className:"".concat($()["mes-user-name"]," font-bold"),title:x,children:f.name})," ",p]})}break;case"ROOM_NAME_UPDATED":o+=" room-updated",t=(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)("span",{children:[i("named the group")," "]}),(0,c.jsx)("span",{className:"".concat($()["mes-user-name"]," font-bold"),title:null===d||void 0===d?void 0:d.newName,children:null===d||void 0===d?void 0:d.newName})]});break;default:m=""}return(0,c.jsx)("div",{className:"".concat(o," text-center flex justify-center"),"data-time-stamp":m,children:(0,c.jsxs)("div",{className:"message-notice-content flex items-center justify-center gap-1 flex-wrap text-xs my-2 bg-gray-300 ".concat(""==t?" hidden":""),style:{padding:"5px 10px",borderRadius:"25px"},children:[s," ",t]})})},K=function(e){var t=e.data,n=(0,j.$G)().t;return(0,c.jsx)(c.Fragment,{children:function(){var e;switch(void 0===t.data?"DELETE":null===t||void 0===t||null===(e=t.data)||void 0===e?void 0:e.type){case"PRIVATE_CHAT_STARTED":return J(t,"");case"ROOM_CREATED":return J(t,n(" created the group"));default:return J(t,void 0)}}()})},Q=function(e){var t=e.data;return e.isGroupMessage?(0,c.jsxs)("div",{className:"text-xs text-center mt-2 mb-2 min-w-full",children:[new Date(t.timestamp).toLocaleString(),(0,c.jsx)("br",{})]}):(0,c.jsx)(c.Fragment,{})},X=function(e){var t=e.data,n=e.isLast,i=e.isActive,r=e.roomId,o=e.isPrivate,a=e.isEnableScroll,l=void 0===a||a,s=e.isGroupMessage,d=void 0===s||s,m=e.hasAvatar,v=void 0!==m&&m,f=e.showAvatarOnly,p=void 0!==f&&f,x=(0,O.v9)(D.tM),g=(null===t||void 0===t?void 0:t.senderId)==(null===x||void 0===x?void 0:x.id);(0,h.useEffect)((function(){var e=document.querySelector(".last-message-".concat(r));l&&null!=e&&e.scrollIntoView()}),[l]);return(0,c.jsx)("div",{id:"message-item-".concat(null===t||void 0===t?void 0:t.id),className:"message-wrap-item flex-wrap ".concat(g&&(null===t||void 0===t?void 0:t.type)!=u.YN.SYSTEM_MESSAGE?"flex justify-end":""," ").concat(n?"last-message-".concat(r):""),children:(null===t||void 0===t?void 0:t.type)==u.YN.SYSTEM_MESSAGE?(0,c.jsx)(K,{isActive:i,data:t}):(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(Q,{data:t,isGroupMessage:d}),(0,c.jsx)(V,{showAvatarOnly:p,hasAvatar:v,isGroupMessage:d,isPrivate:o,roomId:r,isActive:i,data:t})]})})},ee=n(96486),te=function(e){var t=e.messages,n=e.isActive,i=void 0===n||n,r=e.roomId,a=e.isPrivate,l=e.loadMoreHistory,d=e.isEnableScroll,m=(e.currentUserId,(0,h.useRef)(null)),v=(0,h.useRef)(!1),f=(0,h.useRef)(l);(0,h.useEffect)((function(){f.current=l}));var p=(0,h.useRef)((0,ee.throttle)((0,o.Z)((function(){var e,t,n,i,r;return(0,s.__generator)(this,(function(o){switch(o.label){case 0:return!m.current||v.current?[3,2]:(e=m.current,t=e.scrollTop,n=e.scrollHeight,t<(i=1/n*2e5)&&f.current?(window.debugScrollChat&&console.log(t,i),v.current=!0,[4,null===(r=f.current)||void 0===r?void 0:r.call(f)]):[3,2]);case 1:o.sent(),v.current=!1,o.label=2;case 2:return[2]}}))})),300)),x=null,g=0,b=u.YN.SYSTEM_MESSAGE;return(0,c.jsx)("div",{id:"detail-chat-".concat(r),onScroll:function(){return p.current()},ref:m,className:"detail-chat flex-grow overflow-y-auto overflow-x-hidden p-2 pt-6",children:t&&t.length>0&&t.sort((function(e,t){return e.timestamp<t.timestamp?-1:1})).map((function(e,n){var o=!0,l=!0,s=!0;null==x?x=null===e||void 0===e?void 0:e.timestamp:(o=k()(new Date(null===e||void 0===e?void 0:e.timestamp)).diff(new Date(x),"milliseconds")>12e5,l=b==u.YN.SYSTEM_MESSAGE,x=null===e||void 0===e?void 0:e.timestamp,b=e.type);return 0==g||(s=(null===e||void 0===e?void 0:e.senderId)!=g),g=null===e||void 0===e?void 0:e.senderId,(0,c.jsx)(X,{isLast:n==t.length-1,isPrivate:a,roomId:r,isActive:i,data:e,isEnableScroll:d,showAvatarOnly:l,isGroupMessage:o,hasAvatar:s},e.id)}))})},ne=n(15813),ie=n(38623),re=n(95714),oe=function(e){var t=e.roomId,n=e.onCloseListMembers,i=e.isEnableRemoveMember,r=void 0!==i&&i,o=e.onRemoveMember,a=(0,h.useState)(!0),l=a[0],s=a[1],u=(0,j.$G)().t,m=(0,h.useState)({members:[],ownerId:0}),v=m[0],f=m[1];return(0,h.useEffect)((function(){!function(e){d.a.getMembersOfRoom(e).then((function(e){f(e.data),s(!1)})).catch((function(){f({members:[],ownerId:0}),s(!1)}))}(t)}),[t]),(0,c.jsxs)("div",{className:"absolute w-full h-full bg-white z-10 shadow-lg p-2 px-3 border-t-1",style:{top:"-1px"},children:[(0,c.jsx)("span",{onClick:function(){return n()},className:"cursor-pointer absolute right-2 top-1 h-8 w-8 rounded-full transition-all duration-300 inline-flex items-center justify-center hover:bg-critical-background ",children:(0,c.jsx)(g.Z,{size:20,name:"close"})}),!r&&(0,c.jsxs)("p",{className:"font-bold m-0 mb-4",children:[u("Member")," (",(null===v||void 0===v?void 0:v.members)&&(null===v||void 0===v?void 0:v.members.length)," ",(null===v||void 0===v?void 0:v.members)&&(null===v||void 0===v?void 0:v.members.length)>1?u("members"):u("member"),")"]}),r&&(0,c.jsx)("p",{className:"font-bold m-0 mb-4",children:u("Remove member")}),(0,c.jsxs)(p.zv,{visible:l,children:[(0,c.jsx)(ie.O,{className:"mb-2",height:36,width:"100%"}),(0,c.jsx)(ie.O,{className:"mb-2",height:36,width:"100%"}),(0,c.jsx)(ie.O,{className:"mb-2",height:36,width:"100%"}),(0,c.jsx)(ie.O,{className:"mb-2",height:36,width:"100%"}),(0,c.jsx)(ie.O,{className:"mb-2",height:36,width:"100%"})]}),(0,c.jsx)(p.zv,{visible:!l,children:(0,c.jsx)("ul",{className:"overflow-y-auto overflow-x-hidden",style:{maxHeight:"calc(100% - 42px)"},children:(null===v||void 0===v?void 0:v.members)&&(null===v||void 0===v?void 0:v.members.length)>0&&(null===v||void 0===v?void 0:v.members.map((function(e,t){var n=void 0!=(null===e||void 0===e?void 0:e.fullName)&&null!=(null===e||void 0===e?void 0:e.fullName)&&""!=(null===e||void 0===e?void 0:e.fullName)?null===e||void 0===e?void 0:e.fullName:null===e||void 0===e?void 0:e.username,i=void 0!=(null===e||void 0===e?void 0:e.fullName)&&null!=(null===e||void 0===e?void 0:e.fullName)&&""!=(null===e||void 0===e?void 0:e.fullName)?null===e||void 0===e?void 0:e.username:"",a=null===e||void 0===e?void 0:e.avatarUrl,l=!!a&&!a.endsWith("/user.png")?a:"";return(0,c.jsxs)("li",{className:"flex items-center gap-2 mb-3 ".concat($()["member-item"]),children:[(0,c.jsx)(re.ZP,{className:"min-w-[36px]",size:"36",round:!0,src:l,name:n}),(0,c.jsxs)("div",{style:{maxWidth:"calc(100% - 40px)"},className:"flex items-center justify-between flex-grow pr-1",children:[(0,c.jsxs)("strong",{style:{maxWidth:"calc(100% - 15px)"},className:"text-sm flex-grow flex flex-wrap items-center",children:[(0,c.jsx)("span",{title:n,style:{maxWidth:"calc(100% - 30px)"},className:"whitespace-nowrap overflow-hidden overflow-ellipsis",children:n}),(null===e||void 0===e?void 0:e.id)===(null===v||void 0===v?void 0:v.ownerId)?(0,c.jsx)("span",{className:"text-yellow-600",children:(0,c.jsx)(g.Z,{name:"star"})}):"",(0,c.jsx)("span",{title:i,className:"fullname font-normal text-xs whitespace-nowrap overflow-hidden overflow-ellipsis",style:{flex:"0 0 100%"},children:i})]}),r&&(null===e||void 0===e?void 0:e.id)!==(null===v||void 0===v?void 0:v.ownerId)&&(0,c.jsx)("div",{onClick:function(){return o(e.id,null===e||void 0===e?void 0:e.username)},title:u("Remove member"),className:"cursor-pointer hover:text-red-500 flex items-center ".concat($()["btn-remove-member"]),children:(0,c.jsx)(g.Z,{size:18,name:"close"})})]})]},t)})))})})]})},ae=function(e){var t=e.roomId,n=(0,j.$G)().t,i=(0,O.v9)(D.tM),r=(0,h.useState)(!1),o=r[0],a=r[1],l=(0,h.useState)(""),s=l[0],d=l[1],m=(0,h.useState)(""),v=m[0],f=m[1],p=(0,h.useState)(""),x=p[0],b=p[1];return(0,h.useEffect)((function(){var t=w().subscribe(u.qz.REPLY_ACTION,(function(t,r){var o,l,s,c,u=r.data,m=r.roomId;if(e.roomId==m){a(!1);var v=Math.random().toString(32).substring(2,10);b(v);var h=(null===u||void 0===u?void 0:u.senderId)==(null===i||void 0===i?void 0:i.id)?n("yourself"):null===u||void 0===u||null===(o=u.sender)||void 0===o?void 0:o.username,p=null===u||void 0===u||null===(l=u.data)||void 0===l?void 0:l.type,x=null===u||void 0===u||null===(s=u.data)||void 0===s?void 0:s.url,g=n("Attachment file");x.length>0&&(Z.D.isJsonString(x[0])?"image"==JSON.parse(x[0]).type?g=n("Image"):"video"==JSON.parse(x[0]).type?g=n("Video"):"file"==JSON.parse(x[0]).type&&(g=n("Attachment file")):"image"==x[0].type?g=n("Image"):"video"==x[0].type?g=n("Video"):"file"==x[0].type&&(g=n("Attachment file")));var w="ATTACHMENT"==p?g:null===u||void 0===u||null===(c=u.data)||void 0===c?void 0:c.text;if(""!=h){var j,y,_,N;a(!0),d(h),f(w);var C=null===u||void 0===u||null===(j=u.data)||void 0===j?void 0:j.url,E={id:null===u||void 0===u?void 0:u.id,text:Z.D.htmlDecode(null===u||void 0===u||null===(y=u.data)||void 0===y?void 0:y.text),url:C,type:C.length>0?"ATTACHMENT":"MESSAGE",userId:null===u||void 0===u||null===(_=u.sender)||void 0===_?void 0:_.id,userName:null===u||void 0===u||null===(N=u.sender)||void 0===N?void 0:N.username};setTimeout((function(){var e=document.getElementsByClassName("reply-message-".concat(v))[0];null!=e&&e.setAttribute("data-reply-object",z.Z.encodeSingleQuote(JSON.stringify(E)))}),100)}}}));return function(){w().unsubscribe(t)}}),[]),(0,c.jsxs)("div",{id:"reply-area-".concat(t),className:"border-t-slate-200 border-t px-3 py-1 text-sm pr-6 relative reply-message-".concat(x," ").concat(o?"":"hidden"),children:[(0,c.jsx)("span",{title:n("Remove"),className:"flex items-center justify-center cursor-pointer absolute top-1 right-1 hover:text-red",onClick:function(){return a(!1)},children:(0,c.jsx)(g.Z,{name:"close"})}),(0,c.jsxs)("div",{className:"whitespace-nowrap overflow-hidden overflow-ellipsis",children:[(0,c.jsxs)("span",{children:[n("Replying to")," "]}),(0,c.jsx)("strong",{title:s,children:s})]}),(0,c.jsx)("div",{className:"whitespace-nowrap overflow-hidden overflow-ellipsis text-gray-500",title:Z.D.escapeForTitleAttribute(Z.D.htmlDecode(v)),children:Z.D.htmlDecode(v)})]})},le=n(49734),se=n(6781),ce=n(33721),ue=n(10293),de=n(51438),me=n(99158),ve=n(97274),he=n(68040);!function(e){e.SEARCH_USER_BY_USERNAME="/account/search-users-by-username",e.GET_USER_BY_USER_ID="/account/get-user-by-user-id"}(i||(i={})),function(e){e.GET_MANAGED_CAMPUSES="/learn/v2/campus/get-managed-campus"}(r||(r={}));var fe=he.S.getListUri(ve.sl,i),pe=n(7869),xe=function(){function e(){(0,de.Z)(this,e)}return e.getProfileById=function(e){return me.be.get(fe.GET_USER_BY_USER_ID,{params:{userid:e}})},e.searchUser=function(e){return e.Username&&(e.Username=pe.Z.sanitize(e.Username)),me.be.post("".concat(fe.SEARCH_USER_BY_USERNAME),e)},e.searchUserByClass=function(e){return me.be.get("/learn/v2/classes/filter-user-in-class",{params:e})},e.getCampusAdmin=function(){return me.be.get("".concat(r.GET_MANAGED_CAMPUSES))},e}(),ge=n(99534),be=n(7297),we=n(29815),je=n(52015),ye=n(58533),_e=function(e){var t=e.onClickAway,n=e.children,i=e.outside,r=h.useRef(!1);(0,h.useEffect)((function(){return setTimeout((function(){r.current=!0}),0),function(){r.current=!1}}),[]);var o=(0,h.useCallback)((function(e){r.current&&!(null===i||void 0===i?void 0:i.contains(e.target))&&t(e)}),[t,i]);return(0,h.useEffect)((function(){return document.addEventListener("mousedown",o),function(){document.removeEventListener("mousedown",o)}}),[o]),(0,c.jsx)(h.Fragment,{children:n})},Ne=n(95237);function Ce(){var e=(0,be.Z)(["\n  opacity: ",";\n  visibility: ",";\n  pointer-events: ",";\n  z-index: 1200;\n  border: 1px solid #d3d4d5;\n  box-shadow: 0 8px 16px rgba(168, 168, 168, 0.25);\n  border-radius: 3px;\n  background: #fff;\n  box-sizing: border-box;\n  width: ",";\n"]);return Ce=function(){return e},e}var Ee=h.forwardRef((function(e,t){var n=e.children,i=e.open,r=e.onClose,o=e.reference,s=e.option,u=e.placement,d=(0,ge.Z)(e,["children","open","onClose","reference","option","placement"]),m=(0,h.useMemo)((function(){return"Popover-".concat(Math.random().toString(32).substring(2,10))}),[]),v=(0,h.useState)(null),f=v[0],p=v[1],x=(null===o||void 0===o?void 0:o.current)||o,g=(0,Ne.D)(x,f,(0,a.Z)({modifiers:[{name:"offset",options:{offset:[0,4]}},{name:"flip",options:{allowedAutoPlacements:["bottom"],altBoundary:!0}},{name:"preventOverflow",options:{mainAxis:!0}}],placement:u||"bottom-start"},s)),b=g.styles,w=g.attributes,j=g.update;return h.useImperativeHandle(t,(function(){return{update:j}})),(0,h.useEffect)((function(){null===j||void 0===j||j()}),[i]),(0,c.jsx)(_e,{onClickAway:function(e){(null===x||void 0===x?void 0:x.contains(e.target))||r()},outside:document.getElementById(m),children:(0,c.jsx)(Se,(0,l.Z)((0,a.Z)((0,l.Z)((0,a.Z)({},w.popper),{style:(0,a.Z)({},b.popper),open:i,id:m,ref:p}),d),{children:n}))})})),Se=je.ZP.div(Ce(),(function(e){return!e.open&&0}),(function(e){return!e.open&&"hidden"}),(function(e){return!e.open&&"none"}),(function(e){return e.width}));Ee.displayName="Popover";var Ae=(0,h.memo)(Ee);function Ie(){var e=(0,be.Z)(["\n  margin-right: 8px;\n  margin-top: 2px;\n"]);return Ie=function(){return e},e}function Me(){var e=(0,be.Z)(["\n          color: #a3a8af;\n          pointer-events: none;\n        "]);return Me=function(){return e},e}function Te(){var e=(0,be.Z)(["\n          &:hover,\n          &.focused {\n            background: #f3f4f5;\n          }\n        "]);return Te=function(){return e},e}function ke(){var e=(0,be.Z)(["\n  display: flex;\n  flex: none;\n  width: 100%;\n  align-items: center;\n  min-height: 32px;\n  cursor: pointer;\n  border: none;\n  padding: ",";\n  border-radius: 3px;\n  outline: none;\n  background: transparent;\n  box-sizing: border-box;\n  text-align: left;\n  word-break: break-word;\n  font-size: ",';\n\n  &:focus-visible {\n    outline: none;\n  }\n\n  margin: 0;\n\n  &[data-selected="true"] {\n    color: #fff;\n    background: #045fbb;\n  }\n\n  ',";\n"]);return ke=function(){return e},e}var Ze=(0,h.memo)((function(e){var t=e.value,n=e.disabled,i=e.children,r=e.onSelect,o=e.selected,a=e.checkbox,l=e.size,s=void 0===l?"medium":l,u=(0,h.useCallback)((function(e){null===r||void 0===r||r(e,t)}),[t,r]);return(0,c.jsxs)(Re,{"data-selected":o,disabled:n,role:"option","data-event":"true","data-value":t,onClick:u,selected:o,size:s,children:[!!a&&(0,c.jsx)(ze,{size:"xs",checked:o}),i]})}));Ze.displayName="SelectItem";var ze=(0,je.ZP)(p.Jg)(Ie()),Re=je.ZP.button(ke(),(function(e){return"small"===e.size?"4px 8px":"14px 16px"}),(function(e){return"small"===e.size?"0.85rem":"1rem"}),(function(e){var t=e.disabled,n=e.selected;return t?(0,je.iv)(Me()):n?null:(0,je.iv)(Te())})),De=Ze;function Oe(){var e=(0,be.Z)(["\n  pointer-events: none;\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  width: 100%;\n  padding: 0;\n  margin: 0;\n  border-radius: ",";\n  border: 1px solid  ",";\n  overflow: hidden;\n  box-sizing: border-box;\n  border-top: ",";\n  border-left: ",";\n  border-right: ",";\n\n  border-color: "," !important;\n"]);return Oe=function(){return e},e}var Le=(0,h.memo)((function(e){return(0,c.jsx)(Ue,(0,a.Z)({},e))}));Le.displayName="Fieldset";var Fe=Le,Ue=je.ZP.fieldset(Oe(),(function(e){return"standard"===e.variant?"none":"3px"}),(function(e){return e.disabled?"#E2E5E9":"#CED4DA"}),(function(e){return"standard"===e.variant?"none":void 0}),(function(e){return"standard"===e.variant?"none":void 0}),(function(e){return"standard"===e.variant?"none":void 0}),(function(e){e.theme;var t=e.error,n=e.focused;return t?"#FA5252":n?"#045fbb":void 0}));function Pe(){var e=(0,be.Z)(["\n  margin: 0;\n  padding: 4px 12px 0;\n  color: #fa5252;\n"]);return Pe=function(){return e},e}function Be(){var e=(0,be.Z)(["\n  .InfiniteScroll-ListItem {\n    padding: 4px 4px;\n    box-sizing: border-box;\n  }\n"]);return Be=function(){return e},e}function He(){var e=(0,be.Z)(["\n  resize: none;\n  background: #fff;\n  box-sizing: border-box;\n  padding: 10px 12px;\n  width: 100%;\n  border: none;\n  min-height: 40px;\n  max-height: 60px;\n\n  &:focus-visible {\n    outline: none;\n  }\n\n  &::placeholder {\n    font-size: 0.85rem;\n  }\n"]);return He=function(){return e},e}function Ge(){var e=(0,be.Z)(["\n  padding: 8px 12px 6px;\n  flex-direction: row;\n  flex-wrap: wrap;\n  gap: 8px;\n  display: flex;\n  width: 100%;\n  box-sizing: border-box;\n  min-height: 40px;\n  max-height: 174px; //134-40\n  position: relative;\n  overflow: hidden auto;\n"]);return Ge=function(){return e},e}function We(){var e=(0,be.Z)(["\n  position: relative;\n  min-height: ",";\n  max-height: 214px;\n  cursor: pointer;\n  pointer-events: ",";\n  background: ",";\n"]);return We=function(){return e},e}function qe(){var e=(0,be.Z)(["\n  width: 100%;\n  position: relative;\n"]);return qe=function(){return e},e}var Ve=function(e){var t,n,i=e.placement,r=void 0===i?"bottom-start":i,a=e.value,l=(e.disabledClearQuery,e.fetchOptions),u=e.id,d=e.debounceTimeout,m=void 0===d?300:d,v=e.uniqueKey,f=void 0===v?"id":v,x=e.getOptionLabel,b=e.limitTag,w=void 0===b?50:b,y=e.maxHeight,_=void 0===y?260:y,N=e.minHeight,C=e.multiple,E=void 0===C||C,S=e.disabled,A=(0,ge.Z)(e,["placement","value","disabledClearQuery","fetchOptions","id","debounceTimeout","uniqueKey","getOptionLabel","limitTag","maxHeight","minHeight","multiple","disabled"]),I=(0,j.$G)().t,M=(0,h.useMemo)((function(){return u||"TagField-".concat(Math.random().toString(32).substring(2,10))}),[u]),T=(0,h.useRef)(null),k=(0,h.useRef)([]),Z=(0,h.useRef)(!0),z=(0,h.useRef)(!1),R=A.onChange,D=A.error,O=A.helperText,L=A.placeholder,F=(0,h.useState)(!1),U=F[0],P=F[1],B=(0,h.useState)(!1),H=B[0],G=B[1],W=(0,h.useRef)(null),q=(0,h.useState)(""),V=q[0],Y=q[1],$=(0,h.useState)([]),J=$[0],K=$[1],Q=(0,h.useState)({currentPage:1,totalPage:0,totalItems:0}),X=Q[0],te=Q[1],ne=(0,h.useCallback)((function(e){var t;return!(0,ee.isNil)(a)&&(!(!(0,ee.isArray)(a)||!(null===(t=a.filter((function(t){return t[f]===e[f]})))||void 0===t?void 0:t[0]))||a[f]===e[f])}),[a,f]),ie=(0,h.useRef)(0),re=function(e,t){var n=(0,h.useState)(e),i=n[0],r=n[1];return(0,h.useEffect)((function(){var n=setTimeout((function(){r(e)}),t);return function(){clearTimeout(n)}}),[e]),i}(V,m);(0,h.useEffect)((function(){k.current=J})),(0,h.useEffect)((function(){z.current&&U?oe(1):z.current=!0}),[re]);var oe=(0,h.useCallback)((0,o.Z)((function(){var e,t,n,i,r,o,a=arguments;return(0,s.__generator)(this,(function(s){switch(s.label){case 0:e=a.length>0&&void 0!==a[0]?a[0]:X.currentPage,t=a.length>1&&void 0!==a[1]&&a[1],ie.current+=1,n=ie.current,s.label=1;case 1:return s.trys.push([1,3,,4]),[4,l(re,e)];case 2:if(null===(i=s.sent())||void 0===i?void 0:i.data){if(n<ie.current)return[2];Z.current=!1,P(!0),te({currentPage:e,totalPage:Math.ceil(i.total/i.limit),totalItems:i.total}),K((function(e){return t?(0,we.Z)(e).concat((0,we.Z)(i.data)):i.data})),t||(o=null===(r=T.current)||void 0===r?void 0:r.querySelector(".InfiniteScroll-ListItem"))&&(o.scrollTop=0),setTimeout((function(){var e,n=null===(e=T.current)||void 0===e?void 0:e.querySelectorAll("[data-event='true']");!t&&n&&n.length>0&&i.data&&n.forEach((function(e){e.classList.contains("focused")&&e.classList.remove("focused")}))}),10)}return[3,4];case 3:return s.sent(),[3,4];case 4:return[2]}}))})),[l,X.currentPage,re]),ae=(0,h.useCallback)((0,o.Z)((function(){return(0,s.__generator)(this,(function(e){switch(e.label){case 0:return[4,oe(X.currentPage+1,!0)];case 1:return e.sent(),[2]}}))})),[oe,X.currentPage]),le=(0,h.useCallback)((function(e){Y(e.target.value)}),[]),se=(0,h.useCallback)((function(){setTimeout((function(){var e=document.getElementById(M+"Input");null===e||void 0===e||e.focus()}),300)}),[M]),ce=(0,h.useCallback)((function(e,t){if(E)if(null===a||void 0===a?void 0:a.some((function(e){return e[f]==t})))R(a.filter((function(e){return e[f]!=t})));else{var n,i=null===(n=k.current.filter((function(e){return e[f]==t})))||void 0===n?void 0:n[0];if(!i)return;R((0,we.Z)(a).concat([i]))}else{if(Y(""),null===a||void 0===a?void 0:a.some((function(e){return e[f]==t})))R(a.filter((function(e){return e[f]!=t})));else{var r,o=null===(r=k.current.filter((function(e){return e[f]==t})))||void 0===r?void 0:r[0];if(!o)return;R([o])}P(!1),G(!1)}se()}),[R,a,se]),ue=(0,h.useCallback)((function(e){if(null===e||void 0===e?void 0:e.relatedTarget){var t,n,i=e.relatedTarget;if(null===(t=document.querySelectorAll('[data-list="'.concat(M,'"]')))||void 0===t||null===(n=t[0])||void 0===n?void 0:n.contains(i))return}P(!1),G(!1)}),[M]),de=(0,h.useCallback)((function(){ie.current=0,P(!1),K([]),te({currentPage:1,totalPage:0,totalItems:0}),!E&&Y("")}),[ie]),me=(0,h.useCallback)(function(){var e=(0,o.Z)((function(e){var t,n,i,r,o,a,l,c;return(0,s.__generator)(this,(function(s){switch(s.label){case 0:switch(e.key){case"ArrowDown":case"ArrowUp":return[3,1];case"Enter":return[3,2]}return[3,7];case 1:if(t=document.querySelector("[data-list='".concat(M,"']")),n=null===t||void 0===t?void 0:t.querySelector(".focused"),(i=null===t||void 0===t?void 0:t.querySelectorAll("[data-event='true']"))&&n){for(r=i.length,o=0;o<r;o++)if((a=i[o]).classList.contains("focused")){a.classList.remove("focused"),l=o,l="ArrowDown"===e.key?o!==r-1?o+1:0:0!==o?o-1:0,i[l].scrollIntoView({behavior:"smooth",block:"center",inline:"start"}),i[l].classList.add("focused");break}}else i&&i.length>0&&"ArrowDown"===e.key&&i[0].classList.add("focused");return[3,8];case 2:c=1,s.label=3;case 3:return c++,[4,new Promise((function(e){return setTimeout(e,5)}))];case 4:s.sent(),s.label=5;case 5:if(Z.current&&c<300)return[3,3];s.label=6;case 6:return setTimeout((function(){var e=document.querySelector("[data-list='".concat(M,"'] .focused")),t=null===e||void 0===e?void 0:e.getAttribute("data-value");"-1"===t?de():ce({},t)}),10),[3,8];case 7:return[3,8];case 8:return[2]}}))}));return function(t){return e.apply(this,arguments)}}(),[M,V,ce,de]),ve=(0,h.useCallback)((function(){P((function(e){return e||(oe(1).then((function(){})),G(!0)),se(),!0}))}),[oe,se]);return(0,c.jsxs)(et,{children:[(0,c.jsxs)(Xe,{disabled:S,onClick:ve,ref:W,minHeight:N,children:[E&&!!a&&a.length>0&&(0,c.jsx)(Qe,{children:a.map((function(e,t){return t>w&&!H?null:t!==w||H?(0,c.jsx)(p.zx,{color:"dark",variant:"white",className:"bg-[#F1F3F5] pl-[16px] text-[#495057] h-[26px] cursor-default max-w-full",radius:"xs",size:"xs",compact:!0,title:"string"===typeof x(e)?x(e):void 0,uppercase:!0,rightIcon:(0,c.jsx)("div",{className:"cursor-pointer",onClick:function(){return ce(null,e[f])},children:(0,c.jsx)(g.Z,{name:"close"})}),children:x(e)},e[f]):(0,c.jsxs)(p.zx,{color:"dark",variant:"white",className:"bg-[#F1F3F5] text-[#495057] h-[26px]",radius:"xs",size:"xs",compact:!0,uppercase:!0,children:["+",a.length-t]},a.length-t)}))}),!E&&!!(null===a||void 0===a?void 0:a[0])&&(0,c.jsxs)("div",{className:"w-full flex items-center overflow-hidden justify-between",children:[(0,c.jsx)(p.zx,{color:"dark",variant:"white",className:"bg-transparent py-1 px-2 h-[42px] max-w-full overflow-hidden font-normal text-md flex-start",radius:"xs",size:"sm",compact:!0,uppercase:!0,children:x(a[0])}),(0,c.jsx)("div",{className:"cursor-pointer w-6 ",onClick:function(){var e;return ce(null,null===(e=a[0])||void 0===e?void 0:e[f])},children:(0,c.jsx)(g.Z,{name:"close",className:"text-[#868e96] hover:text-[#045fbb]"})})]}),E&&(0,c.jsx)(Ke,{autoComplete:"off",value:V,onChange:le,placeholder:a&&a.length>0?null:L,onKeyDown:me,onBlur:ue}),(0,c.jsx)(Fe,{disabled:S,error:D})]}),(0,c.jsxs)(Ae,{open:U,onClose:de,reference:W,placement:r,width:200<((null===(t=W.current)||void 0===t?void 0:t.clientWidth)||0)?"".concat((null===(n=W.current)||void 0===n?void 0:n.clientWidth)||400,"px"):"400px","data-list":M,children:[!E&&(0,c.jsx)(Ke,{autoComplete:"off",value:V,onChange:le,placeholder:L,onKeyDown:me,onBlur:ue,id:M+"Input"}),J.length>0?(0,c.jsx)(Je,{ref:T,children:(0,c.jsx)(ye.Z,{dataLength:J.length,next:ae,hasMore:X.currentPage<X.totalPage-1,loader:(0,c.jsx)("div",{className:"flex items-center justify-center p-y-2",children:"Loading"}),height:"auto",style:{maxHeight:_,overflow:"hidden auto"},className:"InfiniteScroll-ListItem",children:J.map((function(e){return(0,c.jsx)(De,{checkbox:E,selected:ne(e),onSelect:ce,value:e[f],size:"small",children:x(e)},e[f])}))})}):(0,c.jsx)(p.xv,{className:"px-6 text-gray-secondary",children:I("No results found")})]}),(0,c.jsx)($e,{error:D,children:O})]})};Ve.displayName="TagField";var Ye=(0,h.memo)(Ve),$e=je.ZP.p(Pe()),Je=je.ZP.div(Be()),Ke=je.ZP.input(He()),Qe=je.ZP.div(Ge()),Xe=je.ZP.div(We(),(function(e){return e.minHeight||"72px"}),(function(e){return e.disabled?"none":"auto"}),(function(e){return e.disabled?"#F7F8F9":"transparent"})),et=je.ZP.div(qe()),tt=function(e){var t=e.value,n=e.onChange,i=e.excludeUsernames,r=void 0===i?[]:i,a=e.fetchByClass,l=e.classId,u=e.disabled,d=e.minHeight,m=e.maxHeight,v=e.placement,f=e.multiple,p=void 0===f||f,x=e.placeholder,g=(0,O.v9)(D.tM),b=(0,j.$G)().t,w=(0,h.useCallback)(function(){var t=(0,o.Z)((function(t,n){var i,o,c,u,d,m,v,h,f,p;return(0,s.__generator)(this,(function(s){switch(s.label){case 0:return s.trys.push([0,5,,6]),i=[],o=0,c=10,a?[4,xe.searchUserByClass({userName:(0,ee.isNil)(t)?"":t,classId:l})]:[3,2];case 1:return v=s.sent(),c=9999999,o=(null===v||void 0===v||null===(u=v.data)||void 0===u||null===(d=u.data)||void 0===d?void 0:d.length)||0,i=null===v||void 0===v||null===(m=v.data)||void 0===m?void 0:m.data,[3,4];case 2:return[4,xe.searchUser({Username:(0,ee.isNil)(t)?"":t,Page:n,PageSize:20,CurrentUser:(0,ee.isNil)(e.currentUser)?null===g||void 0===g?void 0:g.UserName:e.currentUser,ExcludeUsernames:r})];case 3:p=s.sent(),i=null===p||void 0===p||null===(h=p.data)||void 0===h||null===(f=h.data)||void 0===f?void 0:f.results,o=p.data.data.rowCount,s.label=4;case 4:return i?[2,Promise.resolve({data:i,total:o,limit:c})]:[2];case 5:return s.sent(),[3,6];case 6:return[2]}}))}));return function(e,n){return t.apply(this,arguments)}}(),[r,l,a]);return(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(Ye,{fetchOptions:w,value:t,placeholder:x||b("Search users"),getOptionLabel:function(e){return null===e||void 0===e?void 0:e.userName},maxHeight:m,onChange:n,placement:v,minHeight:d,multiple:p,disabled:u})})},nt=function(e){var t,n,i=e.open,r=e.onClose,o=e.dataRoom,a=e.onSubmit,l=(0,j.$G)().t,s=(0,h.useState)([]),u=s[0],d=s[1],m=u.length<=0;return(0,c.jsxs)(ue.u,{centered:!0,opened:i,onClose:r,title:(0,c.jsx)("strong",{className:"text-xl",children:l("Add member")}),size:"lg",children:[(0,c.jsxs)("label",{className:"text-sm",children:[l("Friend")," ",(0,c.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,c.jsx)(tt,{excludeUsernames:null===(n=null===o||void 0===o||null===(t=o.members)||void 0===t?void 0:t.map((function(e){return e.username})))||void 0===n?void 0:n.filter((function(e){return!(0,ee.isNil)(e)})),value:u,onChange:d}),(0,c.jsxs)("div",{className:"flex items-center mt-3 gap-2 justify-end",children:[(0,c.jsx)("span",{onClick:function(){return r()},className:"bg-gray-lighter flex items-center justify-center h-10 w-10 rounded-md cursor-pointer",style:{minWidth:"40px"},children:(0,c.jsx)(g.Z,{size:18,name:"close"})}),(0,c.jsx)("span",{onClick:function(){return a(u.map((function(e){return e.id})))},className:"bg-blue-secondary text-white flex items-center justify-center h-10 w-10 rounded-md cursor-pointer ".concat(m?"cursor-not-allowed opacity-40 pointer-events-none":""),style:{minWidth:"40px"},children:(0,c.jsx)(g.Z,{size:18,name:"done"})})]})]})},it=function(e){var t,n,i,r=(0,h.useState)(e.data),b=r[0],y=r[1],_=(0,j.$G)().t,N=(0,O.v9)(D.tM),C=(0,se.t)().locale,S=(0,m.EM)({roomId:b.id,type:null===(t=b.roomType)||void 0===t?void 0:t.toLowerCase(),active:b.active},C),I=S.messages,T=S.closeChanel,k=S.loadMoreMessage,R=S.reConnect,L=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=function(){var t=(0,o.Z)((function(t){var n,i=arguments;return(0,s.__generator)(this,(function(r){switch(r.label){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:"CHAT",[4,d.a.muteChat(t,n).then((function(t){t&&null!=e&&e()})).catch((function(){console.log("Mute member failed")}))];case 1:return r.sent(),[2]}}))}));return function(e){return t.apply(this,arguments)}}();return{muteChat:t}}((function(){w().publish(u.qz.IS_CLOSE_MENU,{id:b.id}),b.mute="CHAT",y((0,a.Z)({},b))})).muteChat,F=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=function(){var t=(0,o.Z)((function(t){return(0,s.__generator)(this,(function(n){switch(n.label){case 0:return[4,d.a.unmuteChat(t).then((function(t){t&&null!=e&&e()})).catch((function(){console.log("Unmute member failed")}))];case 1:return n.sent(),[2]}}))}));return function(e){return t.apply(this,arguments)}}();return{unmuteChat:t}}((function(){w().publish(u.qz.IS_CLOSE_MENU,{id:b.id}),b.mute="null",y((0,a.Z)({},b))})).unmuteChat,U=(0,v.N)((function(e){T()})).clearHistories,B=function(){var e=(0,h.useState)([]),t=e[0],n=e[1];return{dataRoom:t,setFilterDataRoom:function(e){d.a.getMembersOfRoom(e).then((function(e){n(e.data)})).catch((function(){n([])}))}}}(),H=B.dataRoom,G=B.setFilterDataRoom,W=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=function(){var n=(0,o.Z)((function(n,i){return(0,s.__generator)(this,(function(r){switch(r.label){case 0:return[4,d.a.updateRoomName(n,i).then((function(t){null!=e&&e(n)})).catch((function(){null!=t&&e(n),console.log("Update room name failed")}))];case 1:return r.sent(),[2]}}))}));return function(e,t){return n.apply(this,arguments)}}();return{updateRoomName:n}}((function(e){b.name=e,w().publish(u.qz.MANUAL_UPDATE_CHAT_LIST,(0,l.Z)((0,a.Z)({},b),{action:u.kl.EDIT_ROOMNAME})),y(b)})).updateRoomName,q=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=function(){var t=(0,o.Z)((function(t,n){return(0,s.__generator)(this,(function(i){switch(i.label){case 0:return[4,d.a.addMembersToRoom(t,n).then((function(t){null!=e&&e()})).catch((function(){console.log("Add member to room failed")}))];case 1:return i.sent(),[2]}}))}));return function(e,n){return t.apply(this,arguments)}}();return{addMemberToRoom:t}}((function(){xe(!1)})).addMemberToRoom,V=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=function(){var t=(0,o.Z)((function(t,n){return(0,s.__generator)(this,(function(i){switch(i.label){case 0:return[4,d.a.removeMemberFromRoom(t,[n]).then((function(t){t&&null!=e&&e()})).catch((function(){console.log("Remove member failed")}))];case 1:return i.sent(),[2]}}))}));return function(e,n){return t.apply(this,arguments)}}();return{removeMember:t}}((function(){de(!1),we(!1)})).removeMember,Y=(0,f.S)((function(e){T(),w().publish(u.qz.CLOSE_CHAT_WINDOW,{id:b.id}),w().publish(u.qz.ON_FRESH_DATA,{id:b.id})})).leaveRoom,J=(0,ce.r)().markSeenNotifyChat,K=(0,h.useCallback)((function(e){var t;return"private"==(null===(t=e.roomType)||void 0===t?void 0:t.toLowerCase())?{roomName:e.friend.fullName||e.friend.username,roomAvatar:e.friend.avatarUrl}:{roomName:e.name,roomAvatar:"/user.png"}}),[b]),Q=(0,h.useState)(!0),X=Q[0],ee=Q[1],ie=(0,h.useState)(!1),ue=ie[0],de=ie[1],me=(0,h.useState)(!1),ve=me[0],he=me[1],fe=(0,h.useState)(!1),pe=fe[0],xe=fe[1],ge=(0,h.useState)(!1),be=ge[0],we=ge[1];(0,h.useEffect)((function(){var e=w().subscribe(u.qz.ACTION_MENU,(function(e,t){var n=t.id,i=t.action;if(i&&n===b.id)switch(i){case u.kl.EDIT_ROOMNAME:he(!0);break;case u.kl.ADD_MEMBERS:G(b.id),xe(!0);break;case u.kl.LEAVE:(0,x.gH)({message:_("Are you sure to leave this conversation? You will not send or receive messages anymore."),onConfirm:function(){Y(n)}});break;case u.kl.CLEAR_CHAT:U(n),J(n);break;case u.kl.MUTE:L(n,"CHAT");break;case u.kl.UNMUTE:F(n,"CHAT");break;case u.kl.REMOVE_MEMBER:G(b.id),we(!0);break;case u.kl.SHOW_MEMBERS:G(b.id),de(!0)}})),t=w().subscribe(u.hD.PRIVATE_CHAT_STARTED,(function(e,t){var n=t.id;n&&n===b.id&&(b.active=!0,y((0,a.Z)({},b)))})),n=w().subscribe(u.hD.ROOM_MUTE_CONFIG_CHANGE,(function(e,t){var n=t.id,i=t.type;n&&n===(null===b||void 0===b?void 0:b.id)&&(null!=i&&"null"!=i?(b.mute="CHAT",y((0,a.Z)({},b))):(b.mute="null",y((0,a.Z)({},b))))})),i=w().subscribe(u.qz.MANUAL_UPDATE_CHAT_LIST,(function(e,t){var n=t.id,i=t.action;n&&n===(null===b||void 0===b?void 0:b.id)&&i==u.kl.LEAVE&&T()}));return function(){w().unsubscribe(e),w().unsubscribe(t),w().unsubscribe(n),w().unsubscribe(i)}}),[]);var je=function(){var e=(0,o.Z)((function(){var e,t,n,i,r,o,a;return(0,s.__generator)(this,(function(l){switch(l.label){case 0:return null==(t=document.querySelector("#message-item-".concat(null===I||void 0===I||null===(e=I[0])||void 0===e?void 0:e.id," > .message-container")))?[3,3]:t.getAttribute("data-time-stamp")?(ee(!1),[4,k({limit:15,timestamp:null===(n=I[0])||void 0===n?void 0:n.timestamp,chatId:b.id,roomType:b.roomType},C)]):[3,2];case 1:return l.sent(),[3,3];case 2:i=document.querySelector("#chat-window-".concat(b.id," .detail-chat > .chat-nomore-message")),r=document.querySelector("#chat-window-".concat(b.id," .detail-chat")),null==i&&((o=document.createElement("div")).setAttribute("class","chat-nomore-message w-full text-center text-sm mb-2"),a=document.createTextNode(_("No more load")),o.appendChild(a),r.insertBefore(o,r.childNodes[0])),l.label=3;case 3:return[2]}}))}));return function(){return e.apply(this,arguments)}}(),ye=function(){he(!1)},_e=K(b).roomAvatar,Ne=!!_e&&!_e.endsWith("/user.png")||"private"!=(null===(n=b.roomType)||void 0===n?void 0:n.toLowerCase())?_e:"";return(0,h.useEffect)((function(){var e=function(){document.documentElement.style.setProperty("--window-height","".concat(window.innerHeight,"px"))};return window.addEventListener("resize",e),e(),function(){window.removeEventListener("resize",e)}}),[]),(0,c.jsxs)("div",{className:"".concat($()["chat-window-item"]),id:"chat-window-".concat(b.id),children:[(0,c.jsx)("span",{className:"edn-chat-count-new-message",children:(0,c.jsx)("i",{className:"la la-ellipsis-h"})}),(0,c.jsxs)("div",{className:(0,E.Z)("flex items-center justify-between py-2 px-2 relative bg-white",$()["chatbox-header"]),children:[(0,c.jsxs)("div",{className:"".concat($()["user-acc"]," flex items-center flex-grow"),children:[(0,c.jsx)(re.ZP,{className:"object-cover",src:Ne,name:K(b).roomName,size:"32",round:!0}),(0,c.jsx)("div",{id:"group-chat-name-".concat(null===b||void 0===b?void 0:b.id),className:"".concat($()["right-account"]," pl-2 overflow-ellipsis overflow-hidden"),children:(0,c.jsx)("span",{className:"whitespace-nowrap text-sm font-semibold",title:K(b).roomName,children:K(b).roomName})})]}),(0,c.jsxs)("div",{className:"whitespace-nowrap",children:[(0,c.jsx)(A,{id:b.id,isActive:b.active,type:null===(i=b.roomType)||void 0===i?void 0:i.toLowerCase(),inChatBox:!0,mute:null===b||void 0===b?void 0:b.mute,isOwner:(null===b||void 0===b?void 0:b.ownerId)==(null===N||void 0===N?void 0:N.id)}),(0,c.jsx)(P.z,{onClick:function(){w().publish(u.qz.MINIMIZE_CHAT_WINDOW,{id:b.id})},variant:"subtle",className:"w-8 h-8 rounded-full p-0 text-gray-primary",children:(0,c.jsx)(g.Z,{name:"minus",size:"lg"})}),(0,c.jsx)(P.z,{onClick:function(){z.Z.checkConfirmCloseChatbox(b.id)?(0,x.gH)({htmlContent:(0,c.jsxs)("span",{children:[_("You haven't sent your message. Are you sure you want to close chatbox")," ",(0,c.jsx)("strong",{children:K(b).roomName})]}),labelConfirm:_("OK"),onConfirm:function(){T(),w().publish(u.qz.CLOSE_CHAT_WINDOW,{id:b.id})}}):(T(),w().publish(u.qz.CLOSE_CHAT_WINDOW,{id:b.id}))},variant:"subtle",className:"w-8 h-8 rounded-full p-0 text-gray-primary",children:(0,c.jsx)(g.Z,{name:"close",size:"lg"})})]})]}),(0,c.jsxs)("div",{className:"container-chatbox flex-grow relative bg-white",style:{height:"calc(100% - 48px)"},children:[(0,c.jsx)(p.zv,{visible:ue||be,children:(0,c.jsx)(oe,{roomId:null===b||void 0===b?void 0:b.id,onRemoveMember:function(e,t){(0,x.gH)({htmlContent:(0,c.jsxs)("div",{children:[(0,c.jsxs)("p",{className:"font-bold mb-2",children:[_("Are you sure to remove")," ",t," ",_("from the conversation?")]}),(0,c.jsx)("span",{children:_("The member will able to see the previous messages.")})]}),onConfirm:function(){V(b.id,e)}})},isEnableRemoveMember:be,dataRoom:H,onCloseListMembers:function(){de(!1),we(!1)}})}),(0,c.jsx)(p.zv,{visible:ve,children:(0,c.jsx)(M,{onChangeGroupName:function(e){e.match(/^(?!.*<[^>]+>).*/)?e.trim().length>256?le.gU.error(_("Group name must not exceed 256 characters")):(W(Z.D.removeHtmlTag(e),b.id),ye()):le.gU.error(_("Group name cannot be blank and does not include html."))},roomId:null===b||void 0===b?void 0:b.id,onCloseChangeGroupName:ye})}),(0,c.jsx)(p.zv,{visible:pe,children:(0,c.jsx)(nt,{open:!0,dataRoom:H,onSubmit:function(e){q(e,b.id)},roomId:null===b||void 0===b?void 0:b.id,onClose:function(){xe(!1)}})}),(0,c.jsxs)("div",{id:"chatbox-".concat(b.id),className:"chatbox h-full flex flex-col relative",children:[(0,c.jsx)("div",{className:"hidden-option"}),(0,c.jsx)(te,{isPrivate:"Private"==(null===b||void 0===b?void 0:b.roomType),roomId:b.id,isActive:null===b||void 0===b?void 0:b.active,messages:I,loadMoreHistory:je,isEnableScroll:X,currentUserId:null===N||void 0===N?void 0:N.id}),(0,c.jsx)(ae,{roomId:b.id}),(0,c.jsx)(ne.Z,{onReconnect:function(){R()},data:b,isActive:null===b||void 0===b?void 0:b.active,roomType:null===b||void 0===b?void 0:b.roomType,roomId:b.id})]})]})]})}},15813:function(e,t,n){"use strict";n.d(t,{Z:function(){return S}});var i=n(47568),r=n(29815),o=n(70655),a=n(85893),l=n(44104),s=n(79290),c=n(66489),u=n(69728),d=n(49734),m=n(55856),v=n(52615),h=n(67841),f=n(77506),p=n(66314),x=n(67294),g=function(e){(0,p.$G)().t;var t=e.listFile,n=e.onRemoveFile,i=e.roomId;return(0,a.jsx)("div",{className:"display-file-upload-section px-1 py-1 ".concat(t&&0==t.length?"hidden":""),children:(0,a.jsx)("ul",{id:"list-file-upload-".concat(i),className:"flex flex-nowrap gap-1 pt-1 overflow-x-auto",style:{minHeight:"82px"},children:t&&t.length>0&&t.map((function(e,t){return function(e,t){return"video"==(null===e||void 0===e?void 0:e.type)?(0,a.jsxs)("li",{title:null===e||void 0===e?void 0:e.name,className:"h-14 w-14 relative",children:[(0,a.jsx)("span",{onClick:function(){return n(t)},className:"absolute z-10 -top-1 -right-1 cursor-pointer rounded-full bg-red-500 inline-flex items-center justify-center text-white",children:(0,a.jsx)(m.Z,{name:"close",size:18})}),(0,a.jsx)("div",{className:"text-gray flex items-center justify-left",children:(0,a.jsx)("video",{style:{height:"45px",width:"46px",objectFit:"cover"},src:null===e||void 0===e?void 0:e.url})}),(0,a.jsx)("p",{className:"text-xs text-ink-primary overflow-hidden overflow-ellipsis whitespace-nowrap",children:null===e||void 0===e?void 0:e.name})]},null===e||void 0===e?void 0:e.url):"image"==(null===e||void 0===e?void 0:e.type)?(0,a.jsxs)("li",{title:null===e||void 0===e?void 0:e.name,className:"h-14 w-14 relative",children:[(0,a.jsx)("span",{onClick:function(){return n(t)},className:"absolute z-10 -top-1 -right-1 cursor-pointer rounded-full bg-red-500 inline-flex items-center justify-center text-white",children:(0,a.jsx)(m.Z,{name:"close",size:18})}),(0,a.jsx)("div",{className:"text-gray flex items-center justify-left",children:(0,a.jsx)("img",{style:{height:"45px",width:"46px",objectFit:"cover"},src:null===e||void 0===e?void 0:e.url,alt:null===e||void 0===e?void 0:e.name})}),(0,a.jsx)("p",{className:"text-xs text-ink-primary overflow-hidden overflow-ellipsis whitespace-nowrap",children:null===e||void 0===e?void 0:e.name})]},null===e||void 0===e?void 0:e.url):(0,a.jsxs)("li",{title:null===e||void 0===e?void 0:e.name,className:"h-14 w-14 relative",children:[(0,a.jsx)("span",{onClick:function(){return n(t)},className:"absolute z-10 -top-1 -right-1 cursor-pointer rounded-full bg-red-500 inline-flex items-center justify-center text-white",children:(0,a.jsx)(m.Z,{name:"close",size:18})}),(0,a.jsx)("div",{className:"text-gray flex items-center justify-left",children:(0,a.jsx)(m.Z,{name:"description",size:45})}),(0,a.jsx)("p",{className:"text-xs text-ink-primary overflow-hidden overflow-ellipsis whitespace-nowrap",children:null===e||void 0===e?void 0:e.name})]},null===e||void 0===e?void 0:e.url)}(e,t)}))})})},b=n(1798),w=n.n(b),j=n(9473),y=n(33307),_=n(33721),N=n(48929),C=n(83454),E="".concat(C.env.NEXT_PUBLIC_MAX_SIZE_UPLOAD_FILE),S=function(e){var t=e.roomId,n=e.roomType,b=e.isActive,C=void 0===b||b,S=e.data,A=e.onReconnect,I=(0,p.$G)().t,M=(0,j.v9)(N.tM),T=(0,x.useState)([]),k=T[0],Z=T[1],z=(0,x.useState)(!1),R=z[0],D=z[1],O=(0,x.useState)(!1),L=O[0],F=O[1],U=(0,_.r)().markSeenNotifyChat,P=(0,x.useState)(""),B=P[0],H=P[1];(0,x.useEffect)((function(){w().subscribe(l.qz.REPLY_ACTION,(function(e,t){var n=t.data,i=t.roomId;if((null===n||void 0===n?void 0:n.id)&&""!=(null===n||void 0===n?void 0:n.id)){var r=document.getElementById("txt-smg-".concat(i));null!=r&&r.focus()}}));var e=w().subscribe(l.qz.USER_ADD,(function(e,n){n.room_Id==t&&F(!0)}));return function(){w().unsubscribe(e)}}),[]),(0,x.useEffect)((function(){var e=document.getElementById("chatbox-".concat(t));null!=e&&(e.addEventListener("dragover",(function(t){t.preventDefault(),t.stopPropagation(),e.style.border="2px dashed gray"})),e.addEventListener("dragleave",(function(t){t.preventDefault(),t.stopPropagation(),e.style.border="unset"})),e.addEventListener("drop",(function(t){t.preventDefault(),t.stopPropagation();var n=t.dataTransfer.files;V(n),e.style.border="unset"})))}),[]);var G=function(){var e=(0,i.Z)((function(e,t){return(0,o.__generator)(this,(function(n){return(0,c.bG)(e,t),[2]}))}));return function(t,n){return e.apply(this,arguments)}}(),W=function(){var e=t,i=k;if(!(B.length&&B.replace(/\s/g,"").length||i.length>0))return!1;var r="Private"==n,o=null,a=document.getElementById("reply-area-".concat(t));null==a||a.classList.contains("hidden")||(o=a.getAttribute("data-reply-object"));var l=s.Z.MessageData(null,"TEXT",B,i,o,r,null===M||void 0===M?void 0:M.id);G(e,l).then((function(){var e=document.getElementById("reply-area-".concat(t));null!=e&&(o=e.classList.add("hidden")),H(""),Z([]),setTimeout((function(){var e=document.getElementById("detail-chat-".concat(t));if(null!=e){var n=e.scrollTop;e.scrollHeight-e.clientHeight-n>20&&e.scrollTo(0,e.scrollHeight)}}),200)}))},q=(k.length>0||B.length>0)&&C,V=function(){var e=(0,i.Z)((function(e){var n,i,a,l,s,u,m,v,h;return(0,o.__generator)(this,(function(p){switch(p.label){case 0:if((0,c.Qi)(t),null==e)return[3,9];if(!((n=Object.values(e)).length>0))return[3,9];if(!$(n,"upload"))return[2];D(!0),i=!0,a=!1,l=void 0,p.label=1;case 1:p.trys.push([1,6,7,8]),s=function(){var e,t,n,i,a,l,s,c;return(0,o.__generator)(this,(function(o){switch(o.label){case 0:e=m.value,n=null===(t=e)||void 0===t?void 0:t.name,i=J(n),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,y.W.upload(t,f.r5.supportAttach)];case 2:return(null===(l=o.sent())||void 0===l||null===(a=l.data)||void 0===a?void 0:a.success)?Z((function(e){var t,o;return(0,r.Z)(e).concat([{name:n,type:i,url:null===l||void 0===l||null===(t=l.data)||void 0===t||null===(o=t.data)||void 0===o?void 0:o.url}])})):(null===l||void 0===l||null===(s=l.data)||void 0===s?void 0:s.message)&&d.gU.error(I(null===l||void 0===l||null===(c=l.data)||void 0===c?void 0:c.message)),[3,4];case 3:return o.sent(),[3,4];case 4:return[2]}}))},u=n[Symbol.iterator](),p.label=2;case 2:return(i=(m=u.next()).done)?[3,5]:[5,(0,o.__values)(s())];case 3:p.sent(),p.label=4;case 4:return i=!0,[3,2];case 5:return[3,8];case 6:return v=p.sent(),a=!0,l=v,[3,8];case 7:try{i||null==u.return||u.return()}finally{if(a)throw l}return[7];case 8:D(!1),null!=(h=document.getElementById("txt-smg-".concat(t)))&&h.focus(),p.label=9;case 9:return[2]}}))}));return function(t){return e.apply(this,arguments)}}(),Y=function(e){var t=e.split("."),n=t[t.length-1].toLocaleLowerCase();return!["pdf","ppt","pptx","docx","doc","xlsx","xls","rar","7z","png","jpg","jpeg","gif","bmp","mp4","mov","avi","wmv","m4v"].includes(n)},$=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"upload",i=!0,r=[];if("paste"==n){var o=!0,a=!1,l=void 0;try{for(var s,c=e[Symbol.iterator]();!(o=(s=c.next()).done);o=!0){var u=s.value;if("file"==(null===u||void 0===u?void 0:u.kind)){var m=u.getAsFile();r.push(m)}}}catch(h){a=!0,l=h}finally{try{o||null==c.return||c.return()}finally{if(a)throw l}}}else"upload"==n&&(r=e);if(r.some((function(e){return(null===e||void 0===e?void 0:e.name.length)>100}))?(d.gU.error(I("The entire file name must not exceed 100 characters")),i=!1):r.some((function(e){return(null===e||void 0===e?void 0:e.size)>1024*parseInt(E)*1024}))?(d.gU.error(I("Upload file size must not exceed ")+E+"Mb"),i=!1):r.some((function(e){return Y(null===e||void 0===e?void 0:e.name)}))&&(d.gU.error(I("Invalid uploaded file. The system supports files in .pdf,.ppt,.pptx,.docx,.doc,.xlsx,.xls,.rar,.7z,.png,.jpg,.jpeg,.gif,.bmp,.mp4,.mov,.avi,.wmv,.m4v")),i=!1),!i){var v=document.getElementById("edn-cb-mediaCapture-".concat(t));null!=v&&(v.value="")}return i},J=function(e){return/\.(ppt|pptx|doc|docx|xlsx|xls|pdf|rar|7z)$/i.test(e)?"file":/\.(mp4|mov|avi|wmv|m4v)$/i.test(e)?"video":/\.(jpe?g|png|gif|bmp)$/i.test(e)?"image":void 0},K=function(){(0,c.Qi)(t),U(S.id)},Q=function(){var e=(0,i.Z)((function(e){var n,i;return(0,o.__generator)(this,(function(o){return null!=e&&(n=[],i=function(){var t=!0,i=!1,o=void 0;try{for(var a,l=function(){var e=a.value;if("file"!=(null===e||void 0===e?void 0:e.kind))return"continue";D(!0);var t=e.getAsFile(),i=null===t||void 0===t?void 0:t.name,o=J(i),l=y.W.upload(t,f.r5.supportAttach).then((function(e){var t,n,a,l,s,c,u;(null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.success)?(k.push({name:i,type:o,url:null===e||void 0===e||null===(n=e.data)||void 0===n||null===(a=n.data)||void 0===a?void 0:a.url}),Z((0,r.Z)(k))):(null===e||void 0===e||null===(l=e.data)||void 0===l?void 0:l.message)&&null!=(null===e||void 0===e||null===(s=e.data)||void 0===s?void 0:s.message)&&""!=(null===e||void 0===e||null===(c=e.data)||void 0===c?void 0:c.message)&&d.gU.error(I(null===e||void 0===e||null===(u=e.data)||void 0===u?void 0:u.message));return e}));n.push(l)},s=e[Symbol.iterator]();!(t=(a=s.next()).done);t=!0)l()}catch(c){i=!0,o=c}finally{try{t||null==s.return||s.return()}finally{if(i)throw o}}},i(),Promise.all(n).then((function(e){D(!1);var n=document.getElementById("txt-smg-".concat(t));null!=n&&n.focus()}))),[2]}))}));return function(t){return e.apply(this,arguments)}}();return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)("div",{className:"form-send px-2 py-2 border-t-1 ".concat(C?"":"cursor-not-allowed"),children:(0,a.jsxs)("div",{className:"message-form relative rounded-sm",children:[(0,a.jsx)(g,{roomId:t,onRemoveFile:function(e){var t=(0,r.Z)(k);t.splice(e,1),Z(t)},listFile:k}),(0,a.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,a.jsxs)("div",{className:"flex items-center w-8",children:[(0,a.jsx)(u.zv,{visible:R,children:(0,a.jsx)("div",{className:"w-5 h-5",children:(0,a.jsx)(u.LD,{size:"20"})})}),(0,a.jsx)(u.zv,{visible:!R,children:(0,a.jsxs)("span",{id:"chat-upload-btn-".concat(t),className:"inline-flex items-center justify-center chat-btn min-w-8 w-8 h-8",children:[(0,a.jsx)("label",{htmlFor:"edn-cb-mediaCapture-".concat(t),className:"la la-paperclip flex items-center justify-center ".concat(C?"cursor-pointer":"opacity-40 cursor-not-allowed"),children:(0,a.jsx)(m.Z,{name:"paper-clip"})}),(0,a.jsx)("input",{onChange:function(e){return V(e.currentTarget.files)},id:"edn-cb-mediaCapture-".concat(t),name:"edn-cb-mediaCapture",className:"input-upload-file-chat hidden",type:"file",disabled:!C,accept:".pdf,.ppt,.pptx,.docx,.doc,.xlsx,.xls,.rar,.7z,.png,.jpg,.jpeg,.gif,.bmp,.mp4,.mov,.avi,.wmv,.m4v",multiple:!0})]})})]}),(0,a.jsx)("div",{className:"w-full",onClick:function(){return!C&&K()},children:(0,a.jsx)(v.g,{value:B,onChange:function(e){return H(e.target.value)},onKeyDown:function(e){return function(e){if((0,c.Qi)(t),13==e.keyCode){if(e.shiftKey)return;e.preventDefault(),e.currentTarget.focus(),q&&W()}}(e)},onPaste:function(e){return function(e){(0,c.Qi)(t);var n=(e.clipboardData||e.originalEvent.clipboardData).items;n.length<1||$(n,"paste")&&Q(n)}(e)},onClick:function(){return K()},placeholder:I("Typing..."),classNames:{root:"flex-grow w-full",input:"bg-gray-lighter border-0"},radius:"lg",autoFocus:!C,disabled:!C,autosize:!0,minRows:1,maxRows:4,id:"txt-smg-".concat(t)})}),(0,a.jsx)(h.z,{className:"submit chat-btn w-10 h-10 inline-flex items-center justify-center",type:"submit",disabled:!q,title:I("Send"),onClick:function(){document.getElementById("txt-smg-".concat(t)).focus(),q&&W()},children:(0,a.jsx)(m.Z,{name:"paper-plane"})})]}),L&&(0,a.jsx)("div",{onClick:function(){return F(!1),void(A&&A())},className:"absolute text-sm text-center p-1 w-full h-full font-semibold bg-gray-lighter cursor-pointer text-blue-primary",style:{height:"calc(100% + 8px)",width:"calc(100% + 8px)",top:"-4px",left:"-4px"},children:I("You are added to this group. Click here to reload the chat history.")})]})})})}},58551:function(e,t,n){"use strict";n.d(t,{Z:function(){return y}});var i=n(26042),r=n(69396),o=n(85893),a=n(67294),l=n(66489),s=n(55856),c=n(62097),u=n.n(c),d=n(1798),m=n.n(d),v=n(44104),h=n(84644),f=function(e){var t,n,r,a,c,d=e.data,f=e.isShowMoreItem,p=void 0!==f&&f,x=null===d||void 0===d?void 0:d.id,g=(null===d||void 0===d?void 0:d.notifyCount)>0,b=(0,l.EM)({roomId:x,type:null===(t=d.roomType)||void 0===t?void 0:t.toLowerCase(),active:d.active}).closeChanel;return(0,o.jsxs)("div",{className:p?"".concat(u()["bubble-chat-show-more"]):"".concat(u()["bubble-chat-item"]," bg-white relative"),children:[(0,o.jsx)("div",{title:void 0!=(null===d||void 0===d||null===(n=d.friend)||void 0===n?void 0:n.username)?h.D.escapeForTitleAttribute(null===d||void 0===d||null===(r=d.friend)||void 0===r?void 0:r.username):h.D.escapeForTitleAttribute(null===d||void 0===d?void 0:d.name),onClick:function(){return function(){var e=(0,i.Z)({},d);m().publish(v.qz.OPEN_CHAT,{data:e})}()},className:"".concat(u()["bubble-chat-item__name"]),children:(0,o.jsx)("span",{children:void 0!=(null===d||void 0===d||null===(a=d.friend)||void 0===a?void 0:a.username)?null===d||void 0===d||null===(c=d.friend)||void 0===c?void 0:c.username:null===d||void 0===d?void 0:d.name})}),(0,o.jsx)("span",{onClick:function(){return e=null===d||void 0===d?void 0:d.id,b(),void m().publish(v.qz.CLOSE_CHAT_WINDOW,{id:e});var e},className:"".concat(u()["bubble-chat-item__btn-close"]," hover:bg-danger hover:text-white"),children:(0,o.jsx)(s.Z,{size:18,name:"close"})}),g&&!p&&(0,o.jsx)("span",{className:"".concat(u()["bubble-chat-item__fleg-mess"]," bg-danger")})]})},p=n(29355),x=function(e){var t,n=e.showList,i=e.listActiveRoom,r=e.currentUserId,a=(0,p.n)(),l=(a.height,a.width),s=[];return i.length>0&&i.filter((function(e){return"undefined"!=typeof(null===e||void 0===e?void 0:e.isMinimize)&&1==(null===e||void 0===e?void 0:e.isMinimize)})).length>6?(t=i.length>0&&i.filter((function(e){return"undefined"!=typeof(null===e||void 0===e?void 0:e.isMinimize)&&1==(null===e||void 0===e?void 0:e.isMinimize)})).slice(0,5),s=i.length>0&&i.filter((function(e){return"undefined"!=typeof(null===e||void 0===e?void 0:e.isMinimize)&&1==(null===e||void 0===e?void 0:e.isMinimize)})).slice(5)):t=i.length>0&&i.filter((function(e){return"undefined"!=typeof(null===e||void 0===e?void 0:e.isMinimize)&&1==(null===e||void 0===e?void 0:e.isMinimize)})),(0,o.jsxs)("div",{className:"z-[301] fixed bottom-0 ".concat(u()["bubble-chat-list"]),style:{right:n&&l>556?"400px":"0"},children:[t.length>0&&t.map((function(e,t){return(0,o.jsx)(f,{currentUserId:r,data:e},e.id)})),s.length>0&&(0,o.jsxs)("div",{className:"".concat(u()["show-more-bubble"]," bg-white"),children:[(0,o.jsxs)("span",{className:" font-bold text-sm",children:["+",s.length]}),(0,o.jsx)("div",{className:u()["show-more-wrap"],children:s.map((function(e,t){return(0,o.jsx)(f,{currentUserId:r,isShowMoreItem:!0,data:e},e.id)}))})]})]})},g=n(33226),b=n(48929),w=n(9473),j=n(36990),y=function(){var e=(0,w.v9)(j.y6),t=(0,w.v9)(j.Ns),n=(0,w.v9)(j.XD),l=(0,w.v9)(b.tM),s=(0,a.useRef)(null),c=n.flatMap((function(t){var n=null===e||void 0===e?void 0:e.find((function(e){return e.id===t.id}));return n?(0,r.Z)((0,i.Z)({},n),{isMinimize:t.isMinimize,lastActiveTime:t.lastActiveTime}):t}));return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(x,{currentUserId:null===l||void 0===l?void 0:l.id,listActiveRoom:c,showList:t}),c.length>0&&(0,o.jsx)("div",{ref:s,className:"".concat(u()["list-chat-room"]," z-[200] fixed bottom-0 flex flex-row-reverse"),style:{marginRight:c.filter((function(e){return 1==(null===e||void 0===e?void 0:e.isMinimize)})).length>0?"4rem":"0",right:t?"400px":"0",zIndex:"201"},children:c.filter((function(e){return!0!==e.isMinimize})).map((function(e){return(0,o.jsx)(g.Z,{data:e},e.id)}))})]})}},67887:function(e){e.exports={raw_text:"RawText_raw_text__1aeqw",h1:"RawText_h1__RBu8N",h2:"RawText_h2__JXomP",h3:"RawText_h3__renle",h4:"RawText_h4__xw8a0",h5:"RawText_h5__VlpG_","table-border":"RawText_table-border__D5twh",table:"RawText_table__coGOa","none-list":"RawText_none-list__NFxK5",quiz_text:"RawText_quiz_text__jANwV"}},30642:function(e){e.exports={"wrap-chat-item":"ChatItem_wrap-chat-item__a1Aue","wrap-chat-info":"ChatItem_wrap-chat-info__ASD5D","message-item-menu":"ChatItem_message-item-menu__bmnqB","current-user":"ChatItem_current-user__mMOIe","sub-menu":"ChatItem_sub-menu__sInmu","wrap-detail-message":"ChatItem_wrap-detail-message__Pqa_f","submenu-wrap":"ChatItem_submenu-wrap__MdAnw","submenu-content":"ChatItem_submenu-content__7AF0A","content-reply":"ChatItem_content-reply__f2s5f","reply-author":"ChatItem_reply-author__d6V8D","message-text":"ChatItem_message-text__Dgr0q","has-notice":"ChatItem_has-notice__SCORC"}},62097:function(e){e.exports={"user-acc":"ChatWindow_user-acc__wmk5w","right-account":"ChatWindow_right-account__Kfgtz","member-item":"ChatWindow_member-item__VKCkb","btn-remove-member":"ChatWindow_btn-remove-member__eZohT","list-chat-wrap":"ChatWindow_list-chat-wrap__J658e","list-chat-active":"ChatWindow_list-chat-active__kIBN_","list-chat-room":"ChatWindow_list-chat-room__jE96X","bubble-chat-list":"ChatWindow_bubble-chat-list__xj_nb","chat-window-item":"ChatWindow_chat-window-item__MjTBd","chatbox-header":"ChatWindow_chatbox-header__mKRvE","bubble-chat-item":"ChatWindow_bubble-chat-item__oAemP","bubble-chat-item__name":"ChatWindow_bubble-chat-item__name__gz_jj","bubble-chat-item__btn-close":"ChatWindow_bubble-chat-item__btn-close__oCwdg","bubble-chat-item__fleg-mess":"ChatWindow_bubble-chat-item__fleg-mess__vUSPJ","show-more-bubble":"ChatWindow_show-more-bubble__B0pvQ","show-more-wrap":"ChatWindow_show-more-wrap__80CEG","bubble-chat-show-more":"ChatWindow_bubble-chat-show-more__fO9RE","mes-user-name":"ChatWindow_mes-user-name__A5Xjn"}}}]);